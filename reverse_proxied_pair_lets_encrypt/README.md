# Reverse Proxied Pair of Wikis



## Introduction
This configuration sets up a pair of wiki instances behind an nginx reverse proxy, and secures traffic with https, using a certificate provided by [Lets Encrypt](https://letsencrypt.org) and managed by certbot.

One of the wiki instances is configured as a draft server, the other as a production server. 

The difference between a draft and production sever is that a production server requires a login to edit, but can be viewed by anyone. A draft server requires a login to be viewed. 

Additionally, any pages and pdf generated by a draft server is watermarked to make it clear that it's a draft instance.

## Assumptions
This configuration assumes that Nginx will be able to attach to port 80 of the container host.

What this means is that there can't already be a web server (or any application that serves a web page over the normal http port (so you can get to it at `http://some.address/` as opposed to `http://some.address:8080/`))

It is possible to get this install to share with an existing web server, but this will require config changes to the Nginx container, and to the existing web server which are  beyond the scope of this README

## Getting started - Basic

### Install Docker
If you don't already have it installed

[Instructions are here](https://docs.docker.com/engine/install/)

### Ensure you're in the reverse_proxied_pair directory
Change directory so you're in reverse_proxied_pair

### Create a .env file
`cp example.env .env`

Edit `.env` in your favourite editor, and make any tweaks to it that you prefer. 

### Create the certificates needed for HTTPS

First, run `./check_certs.sh` to complete a dry-run of the cert process (you may need to run this as `sudo ./check_certs.sh` if you need to run docker as root). This will identify any issues.

If there are no issues, run `./get_certs.sh` (or `sudo ./get_certs.sh`) to actually acquire certs.

### Start the containers
`docker compose up`

### TODO: cert renewal
`docker compose run --rm certbot renew`

## Getting started - Advanced

